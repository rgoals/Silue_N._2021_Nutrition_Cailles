# Séance 1 {#s1}

Comparaison des effets des régimes pour différentes variables :

  - `masse_oeuf` : masse des oeufs,
  - `masse_coq` : masse de la coquille, 
  - `epaisseur_coq` : épaisseur de la coquille, 
  - `masse_du_jaune` : masse du jaune d'oeuf, 
  - `masse_du_blanc` : masse du blanc d'oeuf, 
  - `l_int_coq` : indice `l` de l'intérieur de la coquille, 
  - `a_int_coq` : indice `a` de l'intérieur de la coquille, 
  - `b_int_coq` : indice `b` de l'intérieur de la coquille, 
  - `l_jaune` : indice `l` du jaune d'oeuf, 
  - `a_jaune` : indice `a` du jaune d'oeuf, 
  - `b_jaune` : indice `b` du jaune d'oeuf, 
  - `prot_tot` : Teneur en protéines totales, 
  - `chol_tot` : Teneur en cholestérol total, 
  - `lip_tot` : Teneur en lipides totales

## Librairies

```{r message = FALSE, warning = FALSE}
library("tidyverse") # tidy et ggplot2
library("agricolae") # SNK.test() Student Newman-Keuls
library("car")       # leveneTest()
library("rstatix")   # convert_as_factor()
library("corrplot")  # matrice de corrélation cor(), corrplot()
library("ggpmisc")   # stat_poly_eq() ajout équation
```

## Les données

```{r}
df <- read_csv("data/seance.csv")
df <- df %>%
  mutate(regime = factor(regime))
```


***


## Masse des oeufs : `masse_oeuf`

```{r}
s1 <- df %>% 
  filter(seance == "seance 1")
```

### Test de normalité, masse des oeufs

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

- Si **p-value > 0,05** alors la distribution des données n’est pas significativement différente de la distribution normale => On accepte Ho.

```{r}
s1 %>% 
  shapiro_test(masse_oeuf)
```

> p-value > 0.05, alors la distribution des données suit une loi normale.

### Test d'homogénéité des variances, masse des oeufs

- `Ho`. Toutes les variances des populations (traitements) sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(masse_oeuf ~ regime, data = s1)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, masse des oeufs

Si la valeur p est inférieure au seuil de signification 0,05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

```{r}
lm1 <- lm(masse_oeuf ~ regime, data = s1)
anova(lm1)
```

> p-value < 0.01, les effets d'au moins deux régimes diffèrent très significativement.

### Visualisation boxplots, masse des oeufs

```{r}
ggplot(data = s1, aes(x = regime, y = masse_oeuf)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Masse de l'oeuf") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

#### Comparaisons par paires, masse des oeufs

Les comparaisons des moyennes par paires :

```{r}
tb_m1 <- (SNK.test(lm1, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, masse_oeuf, groups) %>% 
  as_tibble()
tb_m1
```


### Visualisation des groupes, masse des oeufs

```{r}
ggplot(data = tb_m1, mapping = aes(x = regime, y = masse_oeuf)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_m1, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Masse des oeufs (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```



***


##  Masse de la coquille : `masse_coq`

### Test de normalité, masse de la coquille

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(masse_coq)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité (homogénéité des variances), masse de la coquille

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(masse_coq ~ regime, data = s1)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, masse de la coquille

Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

```{r}
lmc1 <- lm(masse_coq ~ regime, data = s1)
anova(lmc1)
```

> p-value < 0.01 -> au moins deux régimes ont des effets très différents.

### Visualisation boxplots, masse de la coquille

```{r}
ggplot(data = s1, aes(x = regime, y = masse_coq)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Masse de la coquille") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Comparaisons par paires, masse de la coquille

Comparaisons des moyennes par paires

```{r}
tb_mc1 <- (SNK.test(lmc1, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, masse_coq, groups) %>% 
  as_tibble()
tb_mc1
```

### Visualisation des groupes, masse de la coquille

```{r}
ggplot(data = tb_mc1, mapping = aes(x = regime, y = masse_coq)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_mc1, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Masse de la coquille (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```


***


## Épaisseur de la coquille : `epaisseur_coq`

### Test de normalité, épaisseur de la coquille

- Ho. la distribution de l’échantillon est normale (n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(epaisseur_coq)
```

> p-value < 0.05 => distribution non-normale => Test de Kruskal-Wallis, alternative non paramétrique au test ANOVA à un facteur. Recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

### Test de Kruskal-Walli, épaisseur de la coquille

```{r}
s1 %>% 
  kruskal_test(epaisseur_coq ~ regime)
```

> p-value > 0.05 => il n'y a pas de différence significative entre les effets des différents régimes au seuil de 5%. 


***


## Masse du jaune d'oeuf : `masse_du_jaune`

### Test de normalité, masse du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(masse_du_jaune)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité, masse du jaune

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(masse_du_jaune ~ regime, data = s1)
```

> p-value > 0.05, => variances homogènes.

### ANOVA, masse du jaune

```{r}
lmj1 <- lm(masse_du_jaune ~ regime, data = s1)
anova(lmj1)
```

> p-value < 0.05 => au moins deux régimes ont des effets différents.

### Visualisation boxplots masse du jaune

```{r}
ggplot(data = s1, aes(x = regime, y = masse_du_jaune)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Masse du jaune d'oeuf (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Comparaisons par paires, masse du jaune

Comparaisons des moyennes par paires :

```{r}
tb_mj1 <- (SNK.test(lmj1, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, masse_du_jaune, groups) %>% 
  as_tibble()
tb_mj1
```

### Visualisation des groupes, bareplots avec labels, masse du jaune

```{r}
ggplot(data = tb_mj1, mapping = aes(x = regime, y = masse_du_jaune)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_mj1, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Masse du jaune d'oeuf (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```


***


## Masse du blanc d'oeuf : `masse_du_blanc`

### Test de normalité, masse du blanc

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(masse_du_blanc)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité, masse du blanc

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(masse_du_blanc ~ regime, data = s1)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, masse du blanc

```{r}
lmb1 <- lm(masse_du_blanc ~ regime, data = s1)
anova(lmb1)
```

> p-value < 0.01 => au moins deux régimes ont des effets significativement très différents.

### Visualisation boxplots masse du blanc

```{r}
ggplot(data = s1, aes(x = regime, y = masse_du_blanc)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Masse du blanc d'oeuf (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Comparaisons par paires, masse du jaune

Comparaisons des moyennes par paires :

```{r}
tb_mb1 <- (SNK.test(lmb1, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, masse_du_blanc, groups) %>% 
  as_tibble()
tb_mb1
```

### Visualisation des groupes, bareplots avec labels

```{r}
ggplot(data = tb_mb1, mapping = aes(x = regime, y = masse_du_blanc)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_mb1, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Masse du blanc d'oeuf (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```


***


## Indice `l` de l'intérieur de la coquille : `l_int_coq`

### Test de normalité, Indice `l`

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(l_int_coq)
```

> p-value <- 0.01 => distribution non normale => Alternative non-paramétrique : test de Kruskal-Wallis.

### Test de Kruskal-Walli, indice `l`

```{r}
s1 %>% 
  kruskal_test(l_int_coq ~ regime)
```

> p-value > 0.05 => il n'y a pas de différence significative entre les effets des différents régimes au seuil de 5%. 


***


## Indice `a` de l'intérieur de la coquille : `a_int_coq`

### Test de normalité, Indice `a`

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(a_int_coq)
```

> p-value < 0.05 => distribution non normale. Alternative non-paramétrique : test de Kruskal-Wallis.

### Test de Kruskal-Walli, indice `a`

```{r}
s1 %>% 
  kruskal_test(a_int_coq ~ regime)
```

> p-value > 0.05 => il n'y a pas de différence significative entre les effets des différents régimes au seuil de 5%. 


***


## Indice `b` de l'intérieur de la coquille : `b_int_coq`

### Test de normalité, Indice `b`

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(b_int_coq)
```

> p-value < 0.05 => distribution non-normale. Alternative non-paramétrique : test de Kruskal-Wallis.

### Test de Kruskal-Walli, indice `b`

```{r}
s1 %>% 
  kruskal_test(b_int_coq ~ regime)
```

> p-value < 0.05 => il y a une différence entre au moins deux effets de régimes au seuil de 5%.

### Test de Dunn, indice `b`

Pour identifier les groupes différents. Il y a 45 paires à comparer, je choisi d'afficher seulement les groupes différents :

```{r}
s1 %>% 
  dunn_test(b_int_coq ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> Ba 0,75	et WC sont significativement différents. Le plus grand a l'effet moyen le plus élevé. Pas de différence significative avec les autres.

Je calcule les moyennes et écart-types pour visualiser les groupes :

```{r}
s1 %>%
  select(regime, b_int_coq) %>% 
  group_by(regime) %>%
  get_summary_stats(b_int_coq, type = "mean_sd") %>% 
  select(-variable)
```

***


## Indice `l` du jaune d'oeuf : `l_jaune`

### Test de normalité, Indice `l` du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(l_jaune)
```

> p-value < 0.05 => distribution non normale => Alternative non-paramétrique : test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

### Test de Kruskal-Walli, `l` du jaune

```{r}
s1 %>% 
  kruskal_test(l_jaune ~ regime)
```

> p-value > 0.05 => il n'y a pas de différence significative entre les effets des différents régimes au seuil de 5%. 


***


## Indice `a` du jaune d'oeuf : `a_jaune`

### Test de normalité, Indice `a` du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(a_jaune)
```

> p-value < 0.05 => distribution non normale. Alternative non-paramétrique : test de Kruskal-Wallis.

### Test de Kruskal-Walli, `a` du jaune

```{r}
s1 %>% 
  kruskal_test(a_jaune ~ regime)
```

> p-value < 0.05 => il y a une différence entre au moins deux effets de régimes au seuil de 5%.

### Test de Dunn, `a` du jaune

Pour identifier les groupes différents.

```{r}
s1 %>% 
  dunn_test(a_jaune ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> ... Pas de différences ? à revoir !


***


## Indice `b` du jaune d'oeuf : `b_jaune`

### Test de normalité, Indice `b` du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(b_jaune)
```

> p-value < 0.05 => distribution non normale. Alternative non-paramétrique : test de Kruskal-Wallis.

### Test de Kruskal-Walli, `b` du jaune

```{r}
s1 %>% 
  kruskal_test(b_jaune ~ regime)
```

> p-value < 0.05 => il y a une différence entre au moins deux effets de régimes au seuil de 5%.

### Test de Dunn, `b` du jaune

Pour identifier les groupes différents. 

```{r}
s1 %>% 
  dunn_test(b_jaune ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> ... Pas de différences ? à revoir !


***


## Teneur en protéines totales : `prot_tot`

### Test de normalité, protéines

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(prot_tot)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité, protéines

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(prot_tot ~ regime, data = s1)
```

> p-value > 0.05, => variances homogènes.

### ANOVA, protéines

```{r}
lp1 <- lm(prot_tot ~ regime, data = s1)
anova(lp1)
```

> p-value < 0.01 => au moins deux régimes ont des effets significativement très différents.

### Visualisation boxplots, protéines

```{r}
ggplot(data = s1, aes(x = regime, y = prot_tot)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Protéines totales (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Comparaisons par paires, protéines

Comparaisons des moyennes par paires :

```{r}
tb_p1 <- (SNK.test(lp1, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, prot_tot, groups) %>% 
  as_tibble()
tb_p1
```

### Visualisation des groupes, bareplots avec labels, protéines

```{r}
ggplot(data = tb_p1, mapping = aes(x = regime, y = prot_tot)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_p1, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Protéines totales (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```


***


## Teneur en cholestérol total : `chol_tot`

### Test de normalité, cholestérol

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(chol_tot)
```

> p-value < 0.05 => distribution non normale. Alternative non-paramétrique : test de Kruskal-Wallis.

### Test de Kruskal-Walli, `chol_tot`

```{r}
s1 %>% 
  kruskal_test(chol_tot ~ regime)
```

> p-value < 0.05 => il y a une différence entre au moins deux effets de régimes au seuil de 5%.

### Test de Dunn, `chol_tot`

Pour identifier les groupes différents.

```{r}
s1 %>% 
  dunn_test(chol_tot ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> ... pas de différences ? Peut-être la justesse de la p-value qui est ...=... 0.05 ?


***


## Teneur en lipides totales : `lip_tot`

### Test de normalité, lipides

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s1 %>% 
  shapiro_test(lip_tot)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité, lipides

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(lip_tot ~ regime, data = s1)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, lipides

```{r}
ll1 <- lm(lip_tot ~ regime, data = s1)
anova(ll1)
```

> p-value > 0.05 => Pas de différence entre les effets des régimes.


***


## Exploration des corrélations, séance 1

Le corrélogramme suivant met en évidence les éventuelles corrélations dans les séries de données.

```{r fig.width = 10, fig.height = 10}
M1 <- cor(s1[, 4:18])
corrplot(M1, method = "number", type = "upper")
```

Les corrélations positives sont en bleu et les négatives en rouge. Moins la corrélation est importante, moins les chiffres sont visibles (plus, ils sont flous). Là où il y a des points d'intérrogation c'est que la variable contient des valeurs manquantes. **Je les ai juste laissé comme tels si non il y a moyen de calculer sans les valeurs manquantes**.

On peut donc décéler celles dont l'interprétation peut être intéressante en science.

Visualisons graphiquement (un cas) la forte corrélation entre la masse de l'oeuf et celle du blanc d'oeuf (r = 0.91).

```{r}
droitereg <- y ~ x
ggplot(data = s1, aes(x = masse_oeuf, y = masse_du_blanc)) +
  geom_point() +
  geom_smooth(method = lm, formula = droitereg) +
   stat_poly_eq(formula = droitereg,
                eq.with.lhs = "italic(hat(y))~`=`~",
                aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), 
                parse = TRUE)
```













