# Séance 2 {#s2}

```{r message = FALSE, warning = FALSE}
library("tidyverse") # tidy et ggplot2
library("agricolae") # SNK.test() Student Newman-Keuls
library("car")       # leveneTest()
library("rstatix")   # convert_as_factor()
library("corrplot")  # matrice de corrélation cor(), corrplot()
library("ggpmisc")   # stat_poly_eq() ajout équation
df <- read_csv("data/seance.csv")
df <- df %>%
  mutate(regime = factor(regime))
```

## Masse des oeufs `masse_oeuf`

```{r}
s2 <- df %>% 
  filter(seance == "seance 2")
```

### Test de normalité de Shapiro-Wilk, masse des oeufs

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

Si **p-value > 0,05** alors la distribution des données n’est pas significativement différente de la distribution normale. On accepte Ho.

```{r}
s2 %>% 
  shapiro_test(masse_oeuf)
```

> p-value < 0.05 => distribution non-normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(masse_oeuf ~ regime)
```

> p-value < 0.05 => il y a une différence significative entre les effets d'au moins deux régimes sur la masse des oeufs au seuil de 5%.

Un test de Kruskal-Wallis significatif est généralement suivi d’un test de Dunn pour identifier les groupes différents. 

```{r}
s2 %>% 
  dunn_test(masse_oeuf ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> Pourtant, pas de différence détectée avec ce test !!?


***


##  Masse de la coquille `masse_coq`

### Test de normalité de Shapiro-Wilk, masse de la coquille

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(masse_coq)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité (homogénéité des variances), masse de la coquille

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(masse_coq ~ regime, data = s2)
```

> p-value > 0.05, => variances homogènes.

### ANOVA, masse de la coquille

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
lmc2 <- lm(masse_coq ~ regime, data = s2)
anova(lmc2)
```

> p-value < 0.05 => au moins deux régimes ont des effets très différents.

### Visualisation boxplots, masse de la coquille

```{r}
ggplot(data = s2, aes(x = regime, y = masse_coq)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Masse de la coquille") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Test post-hoc, Student-Newman Keuls, masse de la coquille

Comparaisons des moyennes par paires :

```{r}
tb_mc2 <- (SNK.test(lmc2, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, masse_coq, groups) %>% 
  as_tibble()
tb_mc2
```

### Visualisation des groupes, bareplots avec labels, masse de la coquille

```{r}
ggplot(data = tb_mc2, mapping = aes(x = regime, y = masse_coq)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_mc2, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Masse de la coquille (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```


***


## Épaisseur de la coquille `epaisseur_coq`

### Test de normalité de Shapiro-Wilk, épaisseur de la coquille

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(epaisseur_coq)
```

> p-value > 0.05 => distribution normale. 

### Test de sphéricité (homogénéité des variances), épaisseur de la coquille

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(epaisseur_coq ~ regime, data = s2)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, épaisseur de la coquille

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes.

```{r}
lec2 <- lm(epaisseur_coq ~ regime, data = s2)
anova(lec2)
```

> p-value > 0.05 => Pas de différence entre les effets des régimes.


***


## Masse du jaune d'oeuf `masse_du_jaune`

### Test de normalité de Shapiro-Wilk, masse du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(masse_du_jaune)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité (homogénéité des variances), masse du jaune

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(masse_du_jaune ~ regime, data = s2)
```

> p-value > 0.05, => variances homogènes.

### ANOVA masse du jaune

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
lmj2 <- lm(masse_du_jaune ~ regime, data = s2)
anova(lmj2)
```

> p-value < 0.05 => au moins deux régimes ont des effets différents sur la masse du jaune d'oeuf au seuil de 5%.

### Visualisation boxplots masse du jaune

```{r}
ggplot(data = s2, aes(x = regime, y = masse_du_jaune)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Masse du jaune d'oeuf (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Test post-hoc, Student-Newman Keuls, masse du jaune

Comparaisons des moyennes par paires

```{r}
tb_mj2 <- (SNK.test(lmj2, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, masse_du_jaune, groups) %>% 
  as_tibble()
tb_mj2
```

> ??? L'ANOVA prétend cependant qu'il existe au moins 2 effets de régimes significativement différents.

``{r}
cm_mj2 <- multcomp::glht(lmj2, linfct = multcomp::mcp(regime = "Tukey"))
summary(cm_mj2)
``

### Visualisation des groupes, bareplots avec labels

```{r}
ggplot(data = tb_mj2, mapping = aes(x = regime, y = masse_du_jaune)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_mj2, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Masse du jaune d'oeuf (g)") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```


***


## Masse du blanc d'oeuf `masse_du_blanc`

### Test de normalité de Shapiro-Wilk, masse du blanc

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(masse_du_blanc)
```

> p-value < 0.05 => distribution non-normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(masse_du_blanc ~ regime)
```

> p-value < 0.05 => il y a une différence significative entre les effets d'au moins deux régimes sur la masse du blanc d'oeuf au seuil de 5%.

Un test de Kruskal-Wallis significatif est généralement suivi d’un test de Dunn pour identifier les groupes différents. 

```{r}
s2 %>% 
  dunn_test(masse_du_blanc ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> Pas de différence détectée cependant avec le test de Dunn !!?


***


## Indice `l` de l'intérieur de la coquille `l_int_coq`

### Test de normalité de Shapiro-Wilk, Indice `l`

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(l_int_coq)
```

> p-value < 0.05 -> distribution non normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(l_int_coq ~ regime)
```

> p-value < 0.01 => il y a une différence trés significative entre les effets d'au moins 2 régimes sur cet indice au seuil de 5%. 

Test de Dunn pour identifier les groupes différents. 

```{r}
s2 %>% 
  dunn_test(l_int_coq ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

```{r}
s2 %>% 
  select(regime, l_int_coq) %>% 
  group_by(regime) %>% 
  summarise_all(list(l_int_coq_moyen = mean, sd = sd))
```

> le Ba 0,75 et le Ba 7,5 ont des effets très différents sur l'indice l de l'intérieur de la coquille.


***


## Indice `a` de l'intérieur de la coquille `a_int_coq`

### Test de normalité de Shapiro-Wilk, Indice `a`

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(a_int_coq)
```

> p-value < 0.05 => distribution non-normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(a_int_coq ~ regime)
```

> p-value < 0.05 => il y a une différence significative entre les effets d'au moins 2 régimes sur cet indice au seuil de 5%.

Test de Dunn pour identifier les groupes différents. 

```{r}
s2 %>% 
  dunn_test(a_int_coq ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> Pas de différence détectée avec ce test cependant !!?


***


## Indice `b` de l'intérieur de la coquille `b_int_coq`

### Test de normalité de Shapiro-Wilk, Indice `b`

- Ho. La distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(b_int_coq)
```

> p-value < 0.05 => distribution non normale => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(b_int_coq ~ regime)
```

> p-value < 0.05 => il y a une différence entre au moins deux effets de régimes au seuil de 5%.

Test de Dunn pour identifier les groupes différents. 

```{r}
s2 %>% 
  dunn_test(b_int_coq ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

> Pas de différence détectée avec ce test cependant !!?


***


## Indice `l` du jaune d'oeuf `l_jaune`

### Test de normalité de Shapiro-Wilk, Indice `l` du jaune

- Ho. La distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(l_jaune)
```

> p-value < 0.05 -> distribution non-normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(l_jaune ~ regime)
```

> p-value > 0.05 => il n'y a pas de différence significative entre les effets des différents régimes pour cet indice au seuil de 5%. 


***


## Indice `a` du jaune d'oeuf `a_jaune`

### Test de normalité de Shapiro-Wilk, Indice `a` du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(a_jaune)
```

> p-value < 0.05 -> distribution non-normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(a_jaune ~ regime)
```

> p-value > 0.05 => il n'y a pas de différence significative entre les effets des différents régimes pour cet indice au seuil de 5%.


***


## Indice `b` du jaune d'oeuf `b_jaune`

### Test de normalité de Shapiro-Wilk, Indice `b` du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(b_jaune)
```

> p-value < 0.05 -> distribution non normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(b_jaune ~ regime)
```

> p-value >= 0.05 ou valeur très limite ! Le test suivant aidera peut-être à conclure.

Test de Dunn pour identifier les groupes différents. 

```{r}
s2 %>% 
  dunn_test(b_jaune ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

```{r}
s2 %>% 
  select(regime, b_jaune) %>% 
  group_by(regime) %>% 
  summarise_all(list(b_jaune_moyen = mean, sd = sd))
```

> le WC et le YC ont des effets significativement différents sur l'indice b du jaune d'oeuf.


***


## Teneur en protéines totales `prot_tot`

### Test de normalité de Shapiro-Wilk, protéines

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(prot_tot)
```

> p-value < 0.05 => distribution non-normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s2 %>% 
  kruskal_test(prot_tot ~ regime)
```

> p-value < 0.01 : il y a une différence entre au moins deux effets de régimes au seuil de 5%.

Test de Dunn pour identifier les groupes différents. 

```{r}
s2 %>% 
  dunn_test(prot_tot ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

```{r}
s2 %>% 
  select(regime, prot_tot) %>% 
  group_by(regime) %>% 
  summarise_all(list(prot_tot_moyen = mean, sd = sd))
```

> le WC et le Ba-5 ont des effets significativement différents sur l'indice b du jaune d'oeuf.


***


## Teneur en cholestérol total `chol_tot`

### Test de normalité de Shapiro-Wilk, cholestérol

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s2 %>% 
  shapiro_test(chol_tot)
```

> p-value > 0.05 => distribution normale. 

### Test de sphéricité (homogénéité des variances), cholestérol

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(chol_tot ~ regime, data = s2)
```

> p-value > 0.05, => variances homogènes.

### ANOVA, cholestérol

Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

```{r}
lch2 <- lm(chol_tot ~ regime, data = s2)
anova(lch2)
```

> p-value < 0.05 => au moins deux régimes ont des effets différents sur la teneur en cholestérol de l'oeuf au seuil de 5%.

### Visualisation boxplots, cholestérol

```{r}
ggplot(data = s2, aes(x = regime, y = chol_tot)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Teneur en cholestérol de l'oeuf") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Test post-hoc, Student-Newman Keuls, cholestérol

Comparaisons des moyennes par paires

```{r}
tb_ch2 <- (SNK.test(lch2, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, chol_tot, groups) %>% 
  as_tibble()
tb_ch2
```

### Visualisation des groupes, bareplots avec labels, cholestérol

```{r}
ggplot(data = tb_ch2, mapping = aes(x = regime, y = chol_tot)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_ch2, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Teneur en cholestérol de l'oeuf") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```


***


## Teneur en lipides totales `lip_tot`

Lipides non analysées pour cette séance.


***


## Exploration des corrélations, séance 2

Le corrélogramme suivant met en évidence les éventuelles corrélations dans les séries de données.

```{r fig.width = 10, fig.height = 10}
M2 <- cor(s2[, 4:18])
corrplot(M2, method = "number", type = "upper")
```




