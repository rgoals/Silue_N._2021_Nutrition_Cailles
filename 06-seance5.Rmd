# Séance 5 {#s5}

```{r message = FALSE, warning = FALSE}
library("tidyverse") # tidy et ggplot2
library("agricolae") # SNK.test() Student Newman-Keuls
library("car")       # leveneTest()
library("rstatix")   # convert_as_factor()
library("corrplot")  # matrice de corrélation cor(), corrplot()
library("ggpmisc")   # stat_poly_eq() ajout équation
df <- read_csv("data/seance.csv")
df <- df %>%
  mutate(regime = factor(regime))
```

## Masse des oeufs `masse_oeuf`

```{r}
s5 <- df %>% 
  filter(seance == "seance 5")
```

### Test de normalité de Shapiro-Wilk, masse des oeufs

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale)

- H1 ou Ha si non.

- Si **p-value > 0,05** alors la distribution des données n’est pas significativement différente de la distribution normale. On accepte Ho.

```{r}
s5 %>% 
  shapiro_test(masse_oeuf)
```

> p-value > 0.05 => distribution normale. 

### Test de sphéricité (homogénéité des variances), masse des oeufs

Pour ces tests :

- `Ho`. Toutes les variances des populations (traitements) sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

- des valeurs p < à 0,05 suggèrent que les variances sont significativement différentes et donc que l'hypothèse d'homogénéité des variances n'est pas respectée. 

```{r}
leveneTest(masse_oeuf ~ regime, data = s5)
```

> p-value > 0.05, variances homogènes.

### ANOVA, masse des oeufs

- Si la p-value est < 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
lm5 <- lm(masse_oeuf ~ regime, data = s5)
anova(lm5)
```

> p-value > 0.05 => Pas de différences signifcatives entre les effets des régimes.



***


##  Masse de la coquille `masse_coq`

### Test de normalité de Shapiro-Wilk, masse de la coquille

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(masse_coq)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité (homogénéité des variances), masse de la coquille

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(masse_coq ~ regime, data = s5)
```

> p-value > 0.05, => variances homogènes.

### ANOVA, masse de la coquille

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
lmc5 <- lm(masse_coq ~ regime, data = s5)
anova(lmc5)
```

> p-value > 0.05 =>Pas de différences significative entre les effets des régimes.



***


## Épaisseur de la coquille `epaisseur_coq`

### Test de normalité de Shapiro-Wilk, épaisseur de la coquille

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(epaisseur_coq)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité (homogénéité des variances), épaisseur de la coquille

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(epaisseur_coq ~ regime, data = s5)
```

> p-value > 0.05, => variances homogènes.

### ANOVA, épaisseur de la coquille

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
lmj5 <- lm(epaisseur_coq ~ regime, data = s5)
anova(lmj5)
```

> p-value > 0.05 => Pas de différence significative entre les épaisseurs de la coquille au seuil de 5% selon les régimes.



***


## Masse du jaune d'oeuf `masse_du_jaune`

### Test de normalité de Shapiro-Wilk, masse du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(masse_du_jaune)
```

> p-value < 0.05 => distribution non-normale. => Alternative non paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s5 %>% 
  kruskal_test(masse_du_jaune ~ regime)
```

> p-value > 0.05, => Pas de différences significatives entre les effets des régimes.



***


## Masse du blanc d'oeuf `masse_du_blanc`

### Test de normalité de Shapiro-Wilk, masse du blanc

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(masse_du_blanc)
```

> p-value < 0.05 => distribution non-normale. => Alternative non paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s5 %>% 
  kruskal_test(masse_du_blanc ~ regime)
```

> p-value > 0.05, => Pas de différences significatives entre les effets des régimes. 



***


## Indice `l` de l'intérieur de la coquille `l_int_coq`

### Test de normalité de Shapiro-Wilk, Indice `l`

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(l_int_coq)
```

> p-value < 0.05 => distribution non-normale. => Alternative non paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s5 %>% 
  kruskal_test(l_int_coq ~ regime)
```

> p-value > 0.05, => Pas de différences significatives entre les effets des régimes. 



***


## Indice `a` de l'intérieur de la coquille `a_int_coq`

### Test de normalité de Shapiro-Wilk, Indice `a`

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(a_int_coq)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité (homogénéité des variances), Indice `a`

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(a_int_coq ~ regime, data = s5)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, Indice `a`

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
liac5 <- lm(a_int_coq ~ regime, data = s5)
anova(liac5)
```

> p-value > 0.05 => Pas de différences significatives entre les effets des régimes.


***


## Indice `b` de l'intérieur de la coquille `b_int_coq`

### Test de normalité de Shapiro-Wilk, Indice `b`

- Ho. La distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(b_int_coq)
```

> p-value < 0.05 => distribution non-normale. => Alternative non paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s5 %>% 
  kruskal_test(b_int_coq ~ regime)
```

> p-value > 0.05 => Pas de différences significatives entre les effets des régimes.



***


## Indice `l` du jaune d'oeuf `l_jaune`

### Test de normalité de Shapiro-Wilk, Indice `l` du jaune

- Ho. La distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(l_jaune)
```

> p-value > 0.05 => distribution normale.

### Test de sphéricité (homogénéité des variances), Indice `l` du jaune

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(l_jaune ~ regime, data = s5)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, Indice `l` du jaune

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
lilj5 <- lm(l_jaune ~ regime, data = s5)
anova(lilj5)
```

> p-value > 0.05 => Pas de différences significatives entre les effets des régimes.


***


## Indice `a` du jaune d'oeuf `a_jaune`

### Test de normalité de Shapiro-Wilk, Indice `a` du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(a_jaune)
```

> p-value > 0.05 => distribution normale 

### Test de sphéricité (homogénéité des variances), Indice `a` du jaune

- `Ho`. Toutes les variances des populations sont égales.
- `H1` ou `Ha`. Au moins deux d'entre elles diffèrent.

```{r}
leveneTest(a_jaune ~ regime, data = s5)
```

> p-value > 0.05 => variances homogènes.

### ANOVA, Indice `a` du jaune

- Si la p-value est inférieure au seuil de signification 0.05, on conclut qu'il existe des différences significatives entre les groupes (entre au moins deux groupes). 

- si non, il n'y a pas de différence entre les effets des différents régimes. 

```{r}
liaj5 <- lm(a_jaune ~ regime, data = s5)
anova(liaj5)
```

> p-value < 0.01 => au moins deux régimes ont des effets signifiquement très différents.

### Visualisation boxplots, Indice `a` du jaune

```{r}
ggplot(data = s5, aes(x = regime, y = a_jaune)) +
  geom_boxplot() + 
  #theme_classic() +
  xlab("Régimes") + ylab("Indice a du jaune d'oeuf") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```

### Test post-hoc, Student-Newman Keuls, Indice `a` du jaune

Comparaisons des moyennes par paires :

```{r}
tb_iaj5 <- (SNK.test(liaj5, "regime", group = TRUE))$groups %>% 
  mutate(regime = rownames(.)) %>% 
  select(regime, a_jaune, groups) %>% 
  as_tibble()
tb_iaj5
```

### Visualisation des groupes, bareplots avec labels, Indice `a` du jaune

```{r}
ggplot(data = tb_iaj5, mapping = aes(x = regime, y = a_jaune)) +
  geom_bar(stat = "identity", color = "blue", fill = "grey", width = 0.6) +
  #ylim(0, 2) +
  geom_text(data = tb_iaj5, aes(label = groups), vjust = -0.5, size = 4) +
  theme_classic() +
  xlab("Régimes") + ylab("Indice a du jaune d'oeuf") +
  theme(axis.text.x = element_text(angle = 45, color = "black", vjust = 1, hjust = 1))
```



***


## Indice `b` du jaune d'oeuf `b_jaune`

### Test de normalité de Shapiro-Wilk, Indice `b` du jaune

- Ho. la distribution de l’échantillon est normale (ou n'est pas différente d'une distribution normale).

```{r}
s5 %>% 
  shapiro_test(b_jaune)
```

> p-value < 0.05 -> distribution non-normale. => Alternative non-paramétrique : Test de Kruskal-Wallis recommandé lorsque les hypothèses du test ANOVA à un facteur ne sont pas respectées.

```{r}
s5 %>% 
  kruskal_test(b_jaune ~ regime)
```

> p-value ~ 0.05 ... => Test de Dunn pour identifier éventuellement des groupes différents. 

```{r}
s5 %>% 
  dunn_test(b_jaune ~ regime, p.adjust.method = "bonferroni") %>% 
  select(group1, group2, p, p.adj, p.adj.signif) %>% 
  filter(p.adj.signif != "ns")
```

```{r}
s5 %>% 
  select(regime, b_jaune) %>% 
  group_by(regime) %>% 
  summarise_all(list(b_jaune_moyen = mean, sd = sd))
```

> le YC et le Ba-10 ont des effets significativement différents sur l'indice b du jaune d'oeuf.


***


les autres variables ne sont pas analysées pour cette séance.


***


## Exploration des corrélations, séance 5

Le corrélogramme suivant met en évidence les éventuelles corrélations dans les séries de données.

```{r fig.width = 10, fig.height = 10}
M5 <- cor(s5[, 4:18])
corrplot(M5, method = "number", type = "upper")
```











