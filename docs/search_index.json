[["mg.html", "Chapitre 2 Matières grasses 2.1 Les librairies utiles 2.2 Les données 2.3 Sommaire des données, par séance 2.4 Visualisation boxplots, par séance 2.5 Détection valeurs aberrantes 2.6 Conditions de lANOVA 2.7 Comparaisons des effets des régimes sur le taux de MG, par séance 2.8 MESURES REPÉTÉES 2.9 Sphéricité et ANOVA, mesures repétées 2.10 Comparaisons par paires, mesures repétées", " Chapitre 2 Matières grasses 2.1 Les librairies utiles library(&quot;tidyverse&quot;) # tidy et ggplot2 library(&quot;ggpubr&quot;) # ggboxplot() library(&quot;agricolae&quot;) # SNK.test() Student Newman-Keuls library(&quot;car&quot;) # leveneTest() or levene_test() library(&quot;rstatix&quot;) # convert_as_factor() 2.2 Les données mg &lt;- read_csv(&quot;data/mg.csv&quot;) mg &lt;- mg %&gt;% mutate(regime = factor(regime)) head(mg) ## # A tibble: 6 x 6 ## regime reference mg1 mg2 mg3 mg4 ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Ba 0,25 1 56.4 27.1 31 38 ## 2 Ba 0,25 2 52.4 17.1 33.3 28.7 ## 3 Ba 0,25 3 68.4 17.1 25.7 29.9 ## 4 Ba 0,5 1 70.2 20.4 23.3 34.7 ## 5 Ba 0,5 2 70.2 27.1 30.3 28.3 ## 6 Ba 0,5 3 57.2 21.8 8.7 29 Rassembler les colonnes mg1 à mg4 en format long et convertir lidentifiant et les seances en facteurs. mgl &lt;- mg %&gt;% mutate(id = 1:nrow(mg)) %&gt;% gather(key = &quot;seance&quot;, value = &quot;tmg&quot;, -c(regime, reference, id)) %&gt;% convert_as_factor(id, seance) head(mgl) ## # A tibble: 6 x 5 ## regime reference id seance tmg ## &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; ## 1 Ba 0,25 1 1 mg1 56.4 ## 2 Ba 0,25 2 2 mg1 52.4 ## 3 Ba 0,25 3 3 mg1 68.4 ## 4 Ba 0,5 1 4 mg1 70.2 ## 5 Ba 0,5 2 5 mg1 70.2 ## 6 Ba 0,5 3 6 mg1 57.2 Les scores renommés en tmg pour taux de matière grasse. 2.3 Sommaire des données, par séance mgl %&gt;% group_by(seance) %&gt;% get_summary_stats(tmg, type = &quot;mean_sd&quot;) %&gt;% select(-variable) ## # A tibble: 4 x 4 ## seance n mean sd ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 mg1 27 64.8 8.33 ## 2 mg2 30 23.0 5.60 ## 3 mg3 30 27.5 7.94 ## 4 mg4 30 33.3 9.19 2.4 Visualisation boxplots, par séance ggboxplot(mgl, x = &quot;seance&quot;, y = &quot;tmg&quot;) #, add = &quot;point&quot;) 2.5 Détection valeurs aberrantes (Pas pour les exclure !) out_mgl &lt;- mgl %&gt;% group_by(seance) %&gt;% identify_outliers(tmg) out_mgl ## # A tibble: 2 x 7 ## seance regime reference id tmg is.outlier is.extreme ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; ## 1 mg4 Ba 5 2 17 11.7 TRUE FALSE ## 2 mg4 WC 2 29 61 TRUE FALSE 2.6 Conditions de lANOVA 2.6.1 Normalité Si les données sont normalement distribuées, la p-value de Shapiro-Wilk doit être supérieure à 0,05. mgl %&gt;% group_by(seance) %&gt;% shapiro_test(tmg) ## # A tibble: 4 x 4 ## seance variable statistic p ## &lt;fct&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 mg1 tmg 0.978 0.816 ## 2 mg2 tmg 0.974 0.643 ## 3 mg3 tmg 0.936 0.0695 ## 4 mg4 tmg 0.939 0.0873 Toutes les valeurs p sont &gt; 0.05 =&gt; toutes les distributions sont normales. NB. Si la taille de léchantillon est supérieure à 50, le graphique de normalité QQ-plot est préféré parce quavec des échantillons de plus grande taille, le test de Shapiro-Wilk devient très sensible même à un écart mineur par rapport à la distribution normale. Le graphique QQ-plot dessine la corrélation entre une donnée définie et la distribution normale. Ce nest pas le cas ici mais je le fais quand même. Créer des QQ-plots pour chaque point par séance ggqqplot(mgl, &quot;tmg&quot;, facet.by = &quot;seance&quot;) Tous les points se situent approximativement le long de la ligne de référence =&gt; nous pouvons supposer une normalité. 2.6.2 Sphéricité (=&gt; homoscédasticité ou homogénéité des variances) mgl %&gt;% select(seance, regime, tmg) %&gt;% group_by(seance) %&gt;% levene_test(tmg ~ regime) ## # A tibble: 4 x 5 ## seance df1 df2 statistic p ## &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 mg1 9 17 0.735 0.673 ## 2 mg2 9 20 0.124 0.999 ## 3 mg3 9 20 0.773 0.642 ## 4 mg4 9 20 0.782 0.635 Toutes les valeurs p sont &gt; 0.05 =&gt; toutes les variances sont homogènes. 2.7 Comparaisons des effets des régimes sur le taux de MG, par séance Les conditions de la validité dune ANOVA étant remplies, les interprétations seront donc valides. 2.7.1 Séance 1 2.7.1.1 ANOVA, séance 1 aovs1 &lt;- lm(mg1 ~ regime, data = mg) anova(aovs1) ## Analysis of Variance Table ## ## Response: mg1 ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## regime 9 872.25 96.917 1.7694 0.1487 ## Residuals 17 931.15 54.773 La p-value &gt; 0.05 =&gt; Pas de différence entre les effets des différents régimes sur le taux de matières grasses. 2.7.2 Séance 2 2.7.2.1 ANOVA, séance 2 aovs2 &lt;- lm(mg2 ~ regime, data = mg) anova(aovs2) ## Analysis of Variance Table ## ## Response: mg2 ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## regime 9 571.67 63.519 3.7804 0.006354 ** ## Residuals 20 336.05 16.802 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 La p-value est &lt; 0.01 =&gt; Différence très significative entre les effetes dau moins 2 régimes. 2.7.2.2 Visualisation boxplots, séance 2 ggplot(data = mg, aes(x = regime, y = mg2)) + geom_boxplot() + #theme_classic() + xlab(&quot;Régimes&quot;) + ylab(&quot;Taux de matières grasses (g)&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) 2.7.2.3 Comparaisons par paires, séance 2 phs2 &lt;- (SNK.test(aovs2, &quot;regime&quot;, group = TRUE))$groups %&gt;% mutate(regime = rownames(.)) %&gt;% select(regime, mg2, groups) %&gt;% as_tibble() phs2 ## # A tibble: 10 x 3 ## regime mg2 groups ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 YC 32.0 a ## 2 Ba 10 28.4 ab ## 3 Ba 2,5 24.7 ab ## 4 Ba 1 23.6 ab ## 5 Ba 0,5 23.1 ab ## 6 Ba 5 22.6 ab ## 7 Ba 0,75 20.8 b ## 8 Ba 0,25 20.4 b ## 9 Ba 7,5 17.4 b ## 10 WC 17.3 b 2.7.2.4 Visualisation des groupes, séance 2 ggplot(data = phs2, mapping = aes(x = regime, y = mg2)) + geom_bar(stat = &quot;identity&quot;, color = &quot;blue&quot;, fill = &quot;grey&quot;, width = 0.6) + #ylim(0, 2) + geom_text(data = phs2, aes(label = groups), vjust = -0.5, size = 4) + theme_classic() + xlab(&quot;Régimes&quot;) + ylab(&quot;Taux de matières grasses&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) 2.7.3 Séance 3 2.7.3.1 ANOVA, séance 3 aovs3 &lt;- lm(mg3 ~ regime, data = mg) anova(aovs3) ## Analysis of Variance Table ## ## Response: mg3 ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## regime 9 1060.25 117.806 3.0669 0.01766 * ## Residuals 20 768.24 38.412 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 p-value &lt; 0.05 =&gt; Différence significative entre les effetes dau moins 2 régimes. 2.7.3.2 Visualisation boxplots, séance 3 ggplot(data = mg, aes(x = regime, y = mg3)) + geom_boxplot() + #theme_classic() + xlab(&quot;Régimes&quot;) + ylab(&quot;Taux de matières grasses&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) 2.7.3.3 Comparaisons par paires, séance 3 phs3 &lt;- (SNK.test(aovs3, &quot;regime&quot;, group = TRUE))$groups %&gt;% mutate(regime = rownames(.)) %&gt;% select(regime, mg3, groups) %&gt;% as_tibble() phs3 ## # A tibble: 10 x 3 ## regime mg3 groups ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 Ba 7,5 34.9 a ## 2 Ba 0,75 33.1 ab ## 3 YC 32.7 ab ## 4 Ba 1 31.3 ab ## 5 Ba 0,25 30 ab ## 6 Ba 5 28.9 ab ## 7 Ba 2,5 24.7 ab ## 8 WC 22.7 ab ## 9 Ba 0,5 20.8 ab ## 10 Ba 10 15.6 b 2.7.3.4 Visualisation des groupes, séance 3 ggplot(data = phs3, mapping = aes(x = regime, y = mg3)) + geom_bar(stat = &quot;identity&quot;, color = &quot;blue&quot;, fill = &quot;grey&quot;, width = 0.6) + #ylim(0, 2) + geom_text(data = phs3, aes(label = groups), vjust = -0.5, size = 4) + theme_classic() + xlab(&quot;Régimes&quot;) + ylab(&quot;Taux de matières grasses&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) 2.7.4 Séance 4 2.7.4.1 ANOVA, séance 4 aovs4 &lt;- lm(mg4 ~ regime, data = mg) anova(aovs4) ## Analysis of Variance Table ## ## Response: mg4 ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## regime 9 1606.17 178.463 4.2406 0.00343 ** ## Residuals 20 841.68 42.084 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 p-value &lt; 0.01 =&gt; différence très significative entre les effetes dau moins 2 régimes. 2.7.4.2 Visualisation boxplots, séance 4 ggplot(data = mg, aes(x = regime, y = mg4)) + geom_boxplot() + #theme_classic() + xlab(&quot;Régimes&quot;) + ylab(&quot;Taux de matières grasses&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) 2.7.4.3 Comparaisons par paires, séance 4 phs4 &lt;- (SNK.test(aovs4, &quot;regime&quot;, group = TRUE))$groups %&gt;% mutate(regime = rownames(.)) %&gt;% select(regime, mg4, groups) %&gt;% as_tibble() phs4 ## # A tibble: 10 x 3 ## regime mg4 groups ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 WC 43.9 a ## 2 YC 41.8 a ## 3 Ba 7,5 36.6 a ## 4 Ba 2,5 34.4 a ## 5 Ba 10 34.1 a ## 6 Ba 1 33.8 a ## 7 Ba 0,25 32.2 a ## 8 Ba 0,5 30.7 a ## 9 Ba 0,75 29.7 a ## 10 Ba 5 15.5 b 2.7.4.4 Visualisation des groupes, séance 4 ggplot(data = phs4, mapping = aes(x = regime, y = mg4)) + geom_bar(stat = &quot;identity&quot;, color = &quot;blue&quot;, fill = &quot;grey&quot;, width = 0.6) + #ylim(0, 2) + geom_text(data = phs4, aes(label = groups), vjust = -0.5, size = 4) + theme_classic() + xlab(&quot;Régimes&quot;) + ylab(&quot;Taux de matières grasses&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) 2.8 MESURES REPÉTÉES 2.9 Sphéricité et ANOVA, mesures repétées La fonction anova_test() réalise également le test de sphéricité de Mauchly. Données utilisées : Tableau modélé en format long mgl. mg_anova &lt;- anova_test(data = mgl, # dv = tmg, # dependant variable, num wid = id, # identificateur de cas/échantillon (facteur) within = seance) # facteur de groupement intra-sujets get_anova_table(mg_anova) ## ANOVA Table (type III tests) ## ## Effect DFn DFd F p p&lt;.05 ges ## 1 seance 2.23 58 150.342 1.19e-24 * 0.821 Cest la p-value qui nous intéresse et elle est &lt; 0.000 =&gt; Différence statistiquement significative entre au moins 2 séances. 2.10 Comparaisons par paires, mesures repétées tph &lt;- mgl %&gt;% pairwise_t_test(tmg ~ seance, paired = TRUE, p.adjust.method = &quot;bonferroni&quot;) tph %&gt;% select(group1, group2, p, p.adj, p.adj.signif) ## # A tibble: 6 x 5 ## group1 group2 p p.adj p.adj.signif ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 mg1 mg2 8.4 e-19 5.04e-18 **** ## 2 mg1 mg3 1.98e-15 1.19e-14 **** ## 3 mg1 mg4 4.65e-11 2.79e-10 **** ## 4 mg2 mg3 2.4 e- 2 1.47e- 1 ns ## 5 mg2 mg4 6.91e- 6 4.15e- 5 **** ## 6 mg3 mg4 1.1 e- 2 6.8 e- 2 ns mgl %&gt;% group_by(seance) %&gt;% get_summary_stats(tmg, type = &quot;mean_sd&quot;) %&gt;% select(-variable) ## # A tibble: 4 x 4 ## seance n mean sd ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 mg1 27 64.8 8.33 ## 2 mg2 30 23.0 5.60 ## 3 mg3 30 27.5 7.94 ## 4 mg4 30 33.3 9.19 séance 1  séance 2 séance 1  séance 3 séance 1  séance 4 séance 2  séance 4 séance 2  séance 3 séance 3  séance 4. 2.10.0.1 Visualisation : Boxplots avec p-values tph &lt;- tph %&gt;% add_xy_position(x = &quot;seance&quot;) ggboxplot(mgl, x = &quot;seance&quot;, y = &quot;tmg&quot;) + stat_pvalue_manual(tph) + labs( subtitle = get_test_label(mg_anova, detailed = TRUE), caption = get_pwc_label(tph) ) "]]
